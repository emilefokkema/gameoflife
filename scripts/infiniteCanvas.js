!function(){var n={};!function(){var t,e,o,r,i,a,u,s;t=function(n,t){if(n&&1==arguments.length)throw"when making a sender with a reducer, please supply an initial value";var e=[],o=function(){var o=arguments,r=e.map(function(n){return n.apply(null,o)});if(n)return r.reduce(n,t)};return o.add=function(n){return e.push(n),o},o.remove=function(n){var t;-1!=(t=e.indexOf(n))&&e.splice(t,1)},o},e=function(n){var e=null,o=t(),r=t(),i=t(function(n,t){return n&&t},!0),a=t(),u=!1,s=n.getBoundingClientRect(),c=s.width,f=s.height;n.setAttribute("width",c),n.setAttribute("height",f),n.setAttribute("style","width:"+c+"px;height:"+f+"px;");var d=n.getContext("2d"),h=function(t,e){var o=n.getBoundingClientRect();return{x:t-o.left,y:e-o.top}},l=function(){var t=function(t,e){var o=new CustomEvent("positiondragstart",{detail:{x:t,y:e}});n.dispatchEvent(o)},e=function(t,e){var o=new CustomEvent("positiondragmove",{detail:{toX:t,toY:e}});n.dispatchEvent(o)},o=function(){var t=new CustomEvent("positiondragend");n.dispatchEvent(t)},r=function(t){var e=new CustomEvent("startzoom",{detail:{r:t}});n.dispatchEvent(e)},i=function(){var t=new CustomEvent("endzoom");n.dispatchEvent(t)},a=function(t){var e=new CustomEvent("changezoom",{detail:{r:t}});n.dispatchEvent(e)};return{make:function(n,u,s){t(n,u);var c,f={x:n,y:u,id:s},d=function(){return Math.sqrt(Math.pow(f.x-c.x,2)+Math.pow(f.y-c.y,2))};return{moveTo:function(n,t,o){void 0==o||o==f.id?(e(n,t),void 0!=o&&o==f.id&&(f.x=n,f.y=t)):c&&o==c.id&&(c.x=n,c.y=t,a(d()))},end:function(n){void 0==n||n==f.id?o():c&&n==c.id&&(i(),c=null)},add:function(n,t,e){e==f.id||c||(c={x:n,y:t,id:e},r(d()))}}}}}(),v=function(n,t){for(var e=0;e<n.length;e++)t(n.item(e))},m=function(){n.width=c,o()};return n.addEventListener("click",function(n){if(u)return u=!1,n.stopPropagation(),!1;var t=h(n.clientX,n.clientY);r(t.x,t.y,n.shiftKey)}),n.addEventListener("touchstart",function(n){v(n.changedTouches,function(n){var t=h(n.clientX,n.clientY);e?e.add(t.x,t.y,n.identifier):e=l.make(t.x,t.y,n.identifier)})}),n.addEventListener("touchend",function(n){e&&(v(n.changedTouches,function(n){e.end(n.identifier)}),0==n.touches.length&&(e=null))}),n.addEventListener("touchmove",function(n){return v(n.changedTouches,function(n){var t=h(n.clientX,n.clientY);e.moveTo(t.x,t.y,n.identifier)}),u=!0,n.preventDefault(),!1}),n.addEventListener("mousedown",function(n){n.preventDefault();var t=h(n.clientX,n.clientY);e=l.make(t.x,t.y)}),n.addEventListener("mousemove",function(n){if(e&&(0!=n.movementX||0!=n.movementY)){var t=h(n.clientX,n.clientY);e.moveTo(t.x,t.y),u=!0}return!0}),n.addEventListener("mouseup",function(){e&&(e.end(),e=null)}),n.addEventListener("contextmenu",function(n){e&&(e.end(),e=null);var t=h(n.clientX,n.clientY);return i(t.x,t.y,function(){n.preventDefault()})}),n.addEventListener("wheel",function(n){var t=h(n.clientX,n.clientY);return a(t.x,t.y,n.deltaY),n.preventDefault(),!1}),{w:c,h:f,context:d,onDraw:function(n){o.add(n)},drawAll:m,onClick:function(n){r.add(n)},onContextMenu:function(n){i.add(n)},onWheel:function(n){a.add(n)},addEventListener:function(t,e){"click"==t?r=e:n.addEventListener(t,e)},toDataURL:function(){return n.toDataURL.apply(n,arguments)}}},o=function(){var n,t,e,o=function(n,t,e,o,r,i){this.a=n,this.b=t,this.c=e,this.d=o,this.e=r,this.f=i};return o.prototype.before=function(n){var t=this.a*n.a+this.b*n.c,e=this.a*n.b+this.b*n.d,r=this.c*n.a+this.d*n.c,i=this.c*n.b+this.d*n.d,a=this.e*n.a+this.f*n.c+n.e,u=this.e*n.b+this.f*n.d+n.f;return new o(t,e,r,i,a,u)},o.prototype.apply=function(n,t){return{x:this.a*n+this.c*t+this.e,y:this.b*n+this.d*t+this.f}},o.prototype.translate=function(n,e){return t(n,e).before(this)},o.prototype.scale=function(n,t){return e(n,t).before(this)},o.prototype.add=function(n){return n.before(this)},o.prototype.inverse=function(){var n=this.a*this.d-this.b*this.c;if(0==n)throw"error calculating inverse: zero determinant";var t=this.d/n,e=-this.b/n,r=-this.c/n,i=this.a/n,a=(this.c*this.f-this.d*this.e)/n,u=(this.b*this.e-this.a*this.f)/n;return new o(t,e,r,i,a,u)},n=function(n){var t=Math.sin(n),e=Math.cos(n);return new o(e,t,-t,e,0,0)},e=function(n,t){return new o(n,0,0,t,0,0)},t=function(n,t){return new o(1,0,0,1,n,t)},o.rotation=n,o.translation=t,o.scale=e,o}(),r=function(n){var t=function(n,t){this.specs=n,this.currentContextTransform=t};return t.prototype.getTransformableContext=function(){var t=this.currentContextTransform;return{transform:function(e,o,r,i,a,u){t.addToCurrentTransform(new n(e,o,r,i,a,u))},rotate:function(e){t.addToCurrentTransform(n.rotation(e))},scale:function(e,o){t.addToCurrentTransform(n.scale(e,o))},translate:function(e,o){t.addToCurrentTransform(n.translation(e,o))}}},t.prototype.makeIterable=function(){if("function"==typeof Symbol){var n=Symbol.iterator,t={},e=this.makeIterator();return t[n]=function(){return e},t}},t.prototype.makeIterator=function(){var n=this.currentContextTransform.getTransformedViewBox(),t=this.specs.initialIndex||0;"function"==typeof t&&(t=t(n));var e=t,o=this.specs.includeIndex||function(){return!1},r=this.specs.transform||function(){},i=!0,a=0,u=!1,s=(this.specs.plusLimitPoint,this.specs.minLimitPoint,!o(1/0,n)),c=!o(-1/0,n),f=this.getTransformableContext(),d=this.currentContextTransform,h=function(){if(a++,o(e,n)&&(a<100||i&&s||!i&&c)){var l={value:e,done:!1};return u&&d.restoreTransform(),d.saveTransform(),r(e,f),u=!0,i?e++:e--,l}return i?(i=!1,e=t-1,a=0,h()):(d.restoreTransform(),{done:!0})};return{next:h}},t.prototype.each=function(n){for(var t=this.currentContextTransform.getTransformedViewBox(),e=this.specs.minIndex(t),o=this.specs.maxIndex(t),r=e;r<=o;r++)this.currentContextTransform.saveTransform(),this.specs.transform(r,this.transformableContext),n(),this.currentContextTransform.restoreTransform()},t}(o),i=function(n,t){return function(e,o){var r=function(n,t,e,r){var i=o.getTransformedViewBox(),a=i.x-i.width,u=i.x+2*i.width,s=i.y-i.height,c=i.y+2*i.height;return n==1/0&&(n=u),n==-1/0&&(n=a),t==1/0&&(n=c),t==-1/0&&(t=s),e===1/0&&(e=u-n),e==-1/0&&(e=a-n),r===1/0&&(r=c-t),r==-1/0&&(r=s-t),{x:n,y:t,width:e,height:r}},i=function(){},a={};for(var u in e)!function(n){"function"!=typeof e[n]?a[n]={get:function(){return e[n]},set:function(t){e[n]=t}}:a[n]={value:function(){return e[n].apply(e,arguments)}}}(u);return a.getRelativeSize={value:function(n){var t=o.screenPositionToPoint(0,0),e=o.screenPositionToPoint(n,0);return Math.abs(e.x-t.x)}},a.save={value:function(){e.save(),o.saveTransform()}},a.restore={value:function(){e.restore(),o.restoreTransform()}},a.setTransform={value:function(t,e,r,i,a,u){o.setCurrentTransform(new n(t,e,r,i,a,u))}},a.rotate={value:function(t){o.addToCurrentTransform(n.rotation(t))}},a.transform={value:function(t,e,r,i,a,u){o.addToCurrentTransform(new n(t,e,r,i,a,u))}},a.transformMultiple={value:function(n){return new t(n,o).makeIterable()}},a.scale={value:function(t,e){o.addToCurrentTransform(n.scale(t,e))}},a.translate={value:function(t,e){o.addToCurrentTransform(n.translation(t,e))}},a.rect={value:function(n,t,o,i){var a=r(n,t,o,i);e.rect(a.x,a.y,a.width,a.height)}},a.fillRect={value:function(n,t,o,i){var a=r(n,t,o,i);e.fillRect(a.x,a.y,a.width,a.height)}},a.strokeRect={value:function(n,t,o,i){var a=r(n,t,o,i);e.strokeRect(a.x,a.y,a.width,a.height)}},i.prototype=Object.create({},a),new i}}(o,r),a=function(){var n=function(n,t,e,o){this.x=n,this.y=t,this.width=e,this.height=o};return n.prototype.expand=function(t){return new n(this.x-t,this.y-t,this.width+2*t,this.height+2*t)},n}(),u=function(n,t){return function(e,o,r){var i,a,u,s,c=new n(1,0,0,1,0,0),f=new n(1,0,0,1,0,0),d=[],h=function(){u=c.inverse(),i=c.add(f),a=i.inverse(),s=b()},l=function(n,t,e){var o=u.apply(t,e);c=c.translate(o.x,o.y).scale(n,n).translate(-o.x,-o.y),h()},v=function(t,e){var o,r,i,a=function(n,a){i=c,o=n,r=a,t=n,e=a};a(t,e);var u,s,f=function(){c=n.translation(o-t,r-e).add(i),h()},d=function(){c=n.translation(o-t,r-e).add(i),h(),l(s/u,o,r)};return{drag:function(n,t){o=n,r=t,void 0==s?f():d()},startZoom:function(n){u=n,s=n},changeZoom:function(n){s=n,d()},endZoom:function(){u=void 0,s=void 0,a(o,r)}}},m=function(n,t){return u.apply(n,t)},p=function(n){return c.apply(n.x,n.y)},x=function(){f=new n(1,0,0,1,0,0),h(),d=[]},y=function(){d.push(f)},T=function(){d.length&&(f=d.pop(),h(),w())},w=function(){var n=i;e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f)},g=function(){var n=f;e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f)},C=function(n){f=n,h(),w()},E=function(n){f=f.add(n),h(),w()},b=function(){var n=a,e=n.apply(0,0),i=n.apply(0,r),u=n.apply(o,r),s=n.apply(o,0),c=Math.min(e.x,i.x,u.x,s.x),f=Math.max(e.x,i.x,u.x,s.x),d=Math.min(e.y,i.y,u.y,s.y),h=Math.max(e.y,i.y,u.y,s.y);return new t(c,d,f-c,h-d)};return h(),{zoom:l,makeDrag:v,screenPositionToPoint:m,positionToMousePosition:p,removeTransform:x,saveTransform:y,restoreTransform:T,setTransform:w,resetTransform:g,setCurrentTransform:C,addToCurrentTransform:E,getTransformedViewBox:function(){return s}}}}(o,a),s=function(n,t,e,o){var r=function(n){var r=n.w,i=n.h,a=n.context,u=o(a,r,i),s=t(),c=t(),f=t(),d=t(function(n,t){return n&&t},!0),h=t(function(n,t){return n&&t},!0),l=null,v=function(n,t){l=u.makeDrag(n,t)},m=function(n,t){l&&l.drag(n,t)},p=function(){l=null},x=function(n){l&&l.startZoom(n)},y=function(n){l&&l.changeZoom(n)},T=function(){l&&l.endZoom()},w=e(a,u);n.onClick(function(n,t,e){var o=u.screenPositionToPoint(n,t);o.shiftKey=e,c(o)}),n.addEventListener("positiondragmove",function(t){m(t.detail.toX,t.detail.toY),n.drawAll()}),n.addEventListener("positiondragend",function(){p(),f(),n.drawAll()}),n.addEventListener("positiondragstart",function(n){var t=u.screenPositionToPoint(n.detail.x,n.detail.y);h(t.x,t.y)&&v(n.detail.x,n.detail.y)}),n.addEventListener("startzoom",function(n){x(n.detail.r)}),n.addEventListener("changezoom",function(t){y(t.detail.r),n.drawAll()}),n.addEventListener("endzoom",function(n){T()}),n.onDraw(function(){u.removeTransform(),u.setTransform(),s(w),u.resetTransform()}),n.onContextMenu(function(n,t,e){var o=u.screenPositionToPoint(n,t);return d(n,t,o.x,o.y,e)}),n.onWheel(function(t,e,o){u.zoom(Math.pow(2,-o/200),t,e),n.drawAll()});var g=function(n,t,e,o){var r=u.positionToMousePosition({x:n,y:t}),i=u.positionToMousePosition({x:e,y:o});return Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2))<15};return{onDragMove:function(t){n.addEventListener("positiondragmove",function(n){var e=u.screenPositionToPoint(n.detail.toX,n.detail.toY);t(e.x,e.y)})},zoom:u.zoom,drawAll:function(){n.drawAll()},onDraw:function(t){s.add(t),n.drawAll()},onClick:function(n){c.add(n)},onContextMenu:function(n){d.add(n)},onDragStart:function(n){h.add(n)},onDragEnd:function(n){f.add(n)},areClose:g,toDataURL:function(){return n.toDataURL.apply(null,arguments)}}};return function(t){return r(n(t))}}(e,t,i,u),function(t){n.infiniteCanvas=t}(s)}(),"function"==typeof define?define("infiniteCanvas",[],function(){return n.infiniteCanvas}):window.infiniteCanvas=n.infiniteCanvas}();